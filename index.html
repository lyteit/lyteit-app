<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lyteit.com - Financial & Crypto News</title>
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Chart.js for simple charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #000;
            color: #fff;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        /* Privacy Policy Overlay */
        .privacy-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .privacy-overlay.hidden {
            display: none;
        }

        .privacy-card {
            background: #15171a;
            border: 1px solid #333;
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .privacy-card h1 {
            color: #fab005;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .privacy-card h2 {
            color: #fff;
            margin: 20px 0 10px;
            font-size: 1.2rem;
        }

        .privacy-card p {
            color: #8a8d91;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .privacy-card ul {
            color: #8a8d91;
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .privacy-card li {
            margin-bottom: 5px;
        }

        .privacy-footer {
            position: sticky;
            bottom: 0;
            background: #15171a;
            padding: 20px 0 0;
            margin-top: 20px;
            border-top: 1px solid #333;
        }

        .accept-btn {
            background: #fab005;
            color: #000;
            border: 1px solid #fab005;
            padding: 15px 30px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease;
        }

        .accept-btn:hover {
            opacity: 0.9;
        }

        /* Header */
        .sticky-header {
            position: sticky;
            top: 0;
            background: #000;
            z-index: 100;
            border-bottom: 1px solid #222;
        }

        .top-header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-weight: 800;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        .logo span { color: #fab005; }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
        }

        .profile-container {
            position: relative;
        }

        .profile-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1c1f24;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8a8d91;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .profile-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-icon:hover {
            border-color: #fab005;
            color: #fab005;
            background: #2a2f38;
        }

        .profile-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            width: 250px;
            background: #1c1f24;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 10px 0;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .profile-dropdown.show {
            display: block;
        }

        .dropdown-user-info {
            padding: 15px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dropdown-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
        }

        .dropdown-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .dropdown-user-details {
            flex: 1;
        }

        .dropdown-username {
            font-weight: 600;
            color: #fff;
        }

        .dropdown-email {
            font-size: 0.7rem;
            color: #8a8d91;
            word-break: break-all;
        }

        .dropdown-item {
            padding: 12px 20px;
            color: #fff;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .dropdown-item:hover {
            background: #2a2f38;
            color: #fab005;
        }

        .dropdown-item i {
            font-size: 1.2rem;
            color: #fab005;
        }

        .desktop-menu {
            display: none;
            align-items: center;
            gap: 25px;
        }

        @media (min-width: 768px) {
            .desktop-menu {
                display: flex;
            }
        }

        .desktop-menu a {
            color: #8a8d91;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            cursor: pointer;
            padding: 5px 0;
            position: relative;
        }
        
        .desktop-menu a.active {
            color: #fab005;
        }
        
        .desktop-menu a.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #fab005;
            border-radius: 2px;
            animation: slideIn 0.2s ease;
        }
        
        @keyframes slideIn {
            from {
                width: 0;
                opacity: 0;
            }
            to {
                width: 100%;
                opacity: 1;
            }
        }

        .desktop-menu a:hover {
            color: #fab005;
        }

        /* Popup Styles */
        .auth-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .auth-popup-overlay.show {
            display: flex;
        }

        .auth-popup {
            background: #15171a;
            border: 1px solid #333;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .auth-popup h2 {
            color: #fab005;
            margin-bottom: 20px;
            text-align: center;
        }

        .avatar-selector {
            margin-bottom: 20px;
        }

        .avatar-selector label {
            display: block;
            margin-bottom: 10px;
            color: #8a8d91;
        }

        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .avatar-option {
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #333;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .avatar-option:hover {
            border-color: #8a8d91;
        }

        .avatar-option.selected {
            border-color: #fab005;
            transform: scale(1.05);
        }

        .avatar-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #8a8d91;
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            background: #1e2128;
            border: 1px solid #333;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            outline: none;
        }

        .form-group input:focus {
            border-color: #fab005;
        }

        .char-count {
            text-align: right;
            color: #8a8d91;
            font-size: 0.7rem;
            margin-top: 5px;
        }

        .auth-btn {
            width: 100%;
            padding: 14px;
            background: #fab005;
            color: #000;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            margin: 20px 0 15px;
        }

        .auth-switch {
            text-align: center;
            color: #8a8d91;
        }

        .auth-switch span {
            color: #fab005;
            cursor: pointer;
        }

        .auth-switch span:hover {
            text-decoration: underline;
        }

        .close-popup {
            text-align: right;
            margin-bottom: 10px;
        }

        .close-popup i {
            font-size: 1.5rem;
            color: #8a8d91;
            cursor: pointer;
        }

        .close-popup i:hover {
            color: #ff5252;
        }

        .error-message {
            color: #ff5252;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .success-message {
            color: #00c853;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .search-container {
            padding: 0 20px 10px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .search-wrapper {
            background: #1c1f24;
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-radius: 10px;
            gap: 10px;
            border: 1px solid #222;
            transition: all 0.2s ease;
        }

        .search-wrapper:focus-within {
            border-color: #fab005;
            box-shadow: 0 0 0 2px rgba(250, 176, 5, 0.2);
        }

        .search-input {
            background: transparent;
            border: none;
            color: white;
            font-size: 0.95rem;
            width: 100%;
            outline: none;
        }

        .search-input::placeholder { color: #8a8d91; }
        .search-icon { color: #8a8d91; }

        .trending-container {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 0 20px 15px 20px;
            scrollbar-width: none;
            max-width: 1200px;
            margin: 0 auto;
        }
        .trending-container::-webkit-scrollbar { display: none; }

        .trending-item {
            background: #1e2128;
            padding: 8px 16px;
            border-radius: 30px;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .trending-item:hover {
            border-color: #fab005;
            background: #2a2f38;
        }
        .trending-item i {
            color: #fab005;
        }

        .scrollable-content {
            height: calc(100vh - 180px);
            overflow-y: auto;
            padding-bottom: 90px;
        }

        .main-content-area {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .page-indicator {
            padding: 15px 0 5px;
            color: #fab005;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            border-bottom: 1px solid #333;
            margin-bottom: 15px;
        }

        .rss-refresh-btn {
            background: #1e2128;
            border: 1px solid #333;
            color: #fab005;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.7rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-left: auto;
            transition: all 0.2s ease;
        }

        .rss-refresh-btn:hover {
            border-color: #fab005;
            background: #2a2f38;
        }

        .rss-source-badge {
            font-size: 0.65rem;
            color: #fab005;
            display: inline-block;
            background: #fab00520;
            padding: 2px 8px;
            border-radius: 12px;
            margin: 4px 0;
        }

        .newsletter-card {
            background: #15171a;
            border-radius: 20px;
            padding: 25px 20px;
            border: 1px solid #333;
        }
        .newsletter-icon {
            font-size: 2rem;
            color: #fab005;
            margin-bottom: 12px;
        }
        .newsletter-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .newsletter-description {
            font-size: 0.85rem;
            color: #8a8d91;
            margin-bottom: 20px;
        }
        .newsletter-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .newsletter-input {
            flex: 1;
            background: #1c1f24;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 12px 15px;
            color: white;
            outline: none;
        }
        .newsletter-input:focus {
            border-color: #fab005;
        }
        .newsletter-button {
            background: #fab005;
            color: #000;
            border: none;
            border-radius: 12px;
            padding: 0 25px;
            font-weight: 600;
            cursor: pointer;
            height: 45px;
            white-space: nowrap;
        }
        .newsletter-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
        }
        .newsletter-status.success {
            display: block;
            background: #00c85320;
            color: #00c853;
            border: 1px solid #00c853;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #0a0a0a;
            display: flex;
            justify-content: space-around;
            padding: 10px 0 25px 0;
            border-top: 1px solid #222;
            z-index: 100;
            max-width: 1200px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 30px 30px 0 0;
        }

        @media (min-width: 768px) {
            .bottom-nav {
                width: 600px;
                margin: 0 auto;
                border-radius: 30px 30px 0 0;
                box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
            }
        }

        .nav-item { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 4px; 
            color: #8a8d91; 
            text-decoration: none; 
            font-size: 0.65rem; 
            transition: color 0.2s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
        }
        .nav-item:hover {
            color: #fab005;
        }
        .nav-item.active { 
            color: #fab005; 
        }
        .nav-item i { 
            font-size: 1.4rem; 
        }
        .nav-center { 
            background: #fab005; 
            color: #000; 
            width: 45px; 
            height: 45px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin-top: -25px; 
            transition: transform 0.2s ease;
        }
        .nav-center:hover {
            transform: scale(1.05);
        }

        .cache-indicator {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: #1e2128;
            border: 1px solid #fab005;
            border-radius: 30px;
            padding: 8px 16px;
            font-size: 0.7rem;
            color: #fab005;
            z-index: 1000;
            opacity: 0.7;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Privacy Policy Overlay -->
    <div class="privacy-overlay" id="privacyOverlay">
        <div class="privacy-card" id="privacyCard">
            <h1>Privacy Policy</h1>
            <p><strong>Last Updated: February 26, 2026</strong></p>
            
            <h2>1. INTRODUCTION</h2>
            <p>Welcome to lyteit.com ("we," "our," or "us"). We are committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you visit our website and use our mobile application.</p>
            
            <h2>2. INFORMATION WE COLLECT</h2>
            <p><strong>2.1 Information You Provide to Us</strong><br>
            - Account Information: When you create an account, we collect your username, email address, and avatar selection.<br>
            - Communications: Information you provide when contacting us.</p>
            
            <p><strong>2.2 Information Automatically Collected for Advertising and Analytics</strong><br>
            When you use our service, we automatically collect certain information for advertising and analytics purposes, including:</p>
            <ul>
                <li>IP Address: Used to determine general location and prevent fraud</li>
                <li>Device Information: Device type, operating system, browser type, and version</li>
                <li>Device Identifiers: Advertising ID (for ad personalization)</li>
                <li>Usage Data: Pages visited, time spent, clicks, and interactions with content</li>
                <li>Referral Source: How you arrived at our site</li>
            </ul>
            
            <h2>3. HOW WE USE YOUR INFORMATION</h2>
            <p>We use the information we collect to:</p>
            <ul>
                <li>Provide, operate, and maintain our website and app</li>
                <li>Deliver and personalize advertisements</li>
                <li>Measure ad performance and effectiveness</li>
                <li>Improve user experience and content</li>
                <li>Communicate with you about updates and news</li>
                <li>Monitor and analyze usage patterns</li>
                <li>Protect against unauthorized access and fraud</li>
                <li>Comply with legal obligations</li>
            </ul>
            
            <h2>4. THIRD-PARTY SERVICES</h2>
            <p>Our service integrates with various third-party providers to function properly. These include authentication services, analytics providers, advertising partners, content providers, and infrastructure services. These third parties may collect or receive certain information about you as described in Section 2.2.</p>
            
            <h2>5. SMART LINKS AND MONETIZATION</h2>
            <p>Our service uses smart links that may redirect you to third-party websites or platforms. When you click on these links, we may receive compensation when you visit or take specific actions on partner sites. These links are identified with clear labeling (e.g., "Sponsored Link").</p>
            
            <h2>6. COOKIES AND TRACKING TECHNOLOGIES</h2>
            <p>We use cookies and similar technologies to remember your preferences, understand how you use our site, deliver relevant advertisements, track ad performance, and analyze traffic patterns. You can control cookies through your browser settings.</p>
            
            <h2>7. DATA SHARING AND DISCLOSURE</h2>
            <p>We do not sell your personal information. We may share information with advertising partners to deliver and measure ads, with your consent, for legal reasons, to protect our rights and safety, and with service providers who assist in operating our platform.</p>
            
            <h2>8. YOUR RIGHTS AND CHOICES</h2>
            <p>Depending on your location, you may have the right to access your personal information, correct inaccurate data, delete your data, opt-out of targeted advertising, object to processing, and data portability. To exercise these rights, contact us at: hello@lyteit.com</p>
            
            <h2>9. CONTACT US</h2>
            <p>If you have questions about this Privacy Policy, please contact us:<br>
            Email: hello@lyteit.com<br>
            Website: https://lyteit.com</p>
            
            <div class="privacy-footer">
                <button class="accept-btn" id="acceptPrivacyBtn">Accept & Continue</button>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container" id="appContainer" style="display: none;">
        <div class="cache-indicator" id="cacheIndicator">
            <i class="ph ph-database"></i> Cache enabled
        </div>

        <!-- Header -->
        <div class="sticky-header">
            <div class="top-header">
                <div class="logo" id="logo">
                    <i class="ph-fill ph-lightning"></i>
                    lyteit<span>.com</span>
                </div>
                
                <div class="desktop-menu">
                    <a onclick="navigateTo('home')" id="top-nav-home">Home</a>
                    <a onclick="navigateTo('explore')" id="top-nav-explore">Explore</a>
                    <a onclick="navigateTo('markets')" id="top-nav-markets">Markets</a>
                </div>

                <div class="header-right">
                    <div class="profile-container" id="profileContainer">
                        <div class="profile-icon" id="profileIcon">
                            <i class="ph ph-user"></i>
                        </div>
                        <div class="profile-dropdown" id="profileDropdown">
                            <!-- Dropdown content will be populated by JavaScript -->
                        </div>
                    </div>
                    <i class="ph ph-bell bell-icon"></i>
                </div>
            </div>

            <div id="homeSearch" class="search-container">
                <div class="search-wrapper">
                    <i class="ph ph-magnifying-glass search-icon"></i>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search news, coins, topics...">
                </div>
            </div>

            <div id="homeTrending" class="trending-container"></div>
        </div>

        <!-- Content -->
        <div class="scrollable-content" id="scrollableContent">
            <div class="main-content-area" id="mainContent"></div>

            <!-- Footer -->
            <div class="footer-section">
                <div class="footer-grid">
                    <div class="newsletter-card">
                        <div class="newsletter-icon"><i class="ph ph-envelope"></i></div>
                        <div class="newsletter-title">Never Miss a Story</div>
                        <div class="newsletter-description">
                            Get the top 5 crypto stories delivered to your inbox daily. Zero spam.
                        </div>
                        <div class="newsletter-form">
                            <input type="email" class="newsletter-input" id="newsletterEmail" placeholder="your@email.com" readonly>
                            <button class="newsletter-button" id="subscribeBtn">Subscribe</button>
                        </div>
                        <div class="newsletter-status" id="newsletterStatus"></div>
                    </div>

                    <div class="app-promo">
                        <h3 style="margin-bottom: 10px;">Take Us Everywhere</h3>
                        <div class="app-buttons">
                            <div class="app-button" id="appStoreBtn">
                                <i class="ph-fill ph-apple-logo"></i>
                                <span>App Store</span>
                            </div>
                            <div class="app-button" id="playStoreBtn">
                                <i class="ph-fill ph-google-play-logo"></i>
                                <span>Google Play</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="back-to-top" id="backToTop">
                    <i class="ph ph-arrow-up"></i>
                    <span>Back to Top</span>
                </div>

                <div class="footer-links">
                    <span class="footer-link" id="aboutLink">About</span>
                    <span class="footer-link" id="privacyLink">Privacy</span>
                    <span class="footer-link" id="termsLink">Terms</span>
                    <span class="footer-link" id="contactLink">Contact</span>
                </div>
                <div class="copyright">⚡ lyteit.com © 2026 · All rights reserved</div>
            </div>
        </div>

        <!-- Bottom Nav -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="navigateTo('home')" id="nav-home">
                <i class="ph-fill ph-house"></i>
                <span>Home</span>
            </button>
            <button class="nav-item" onclick="navigateTo('explore')" id="nav-explore">
                <i class="ph ph-compass"></i>
                <span>Explore</span>
            </button>
            <button class="nav-item" onclick="navigateTo('play')" id="nav-play">
                <div class="nav-center"><i class="ph-fill ph-play"></i></div>
            </button>
            <button class="nav-item" onclick="navigateTo('markets')" id="nav-markets">
                <i class="ph ph-chart-line-up"></i>
                <span>Markets</span>
            </button>
            <button class="nav-item" onclick="navigateTo('menu')" id="nav-menu">
                <i class="ph ph-list"></i>
                <span>Menu</span>
            </button>
        </nav>
    </div>

    <!-- Auth Popups -->
    <div class="auth-popup-overlay" id="signupPopup">
        <div class="auth-popup">
            <div class="close-popup">
                <i class="ph ph-x" onclick="closeAuthPopups()"></i>
            </div>
            <h2>Create Account</h2>
            
            <div class="avatar-selector">
                <label>Choose Avatar</label>
                <div class="avatar-grid" id="avatarGrid">
                    <!-- Avatars will be populated by JavaScript -->
                </div>
            </div>

            <div class="form-group">
                <label>Username (max 9 characters)</label>
                <input type="text" id="signupUsername" maxlength="9">
                <div class="char-count"><span id="usernameCount">0</span>/9</div>
            </div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" id="signupEmail">
            </div>

            <div class="form-group">
                <label>Password (3-8 characters)</label>
                <input type="password" id="signupPassword" maxlength="8">
                <div class="char-count"><span id="passwordCount">0</span>/8</div>
            </div>

            <div id="signupError" class="error-message"></div>

            <button class="auth-btn" onclick="handleSignup()">Sign Up</button>
            <div class="auth-switch">
                Already have an account? <span onclick="showLogin()">Login</span>
            </div>
        </div>
    </div>

    <div class="auth-popup-overlay" id="loginPopup">
        <div class="auth-popup">
            <div class="close-popup">
                <i class="ph ph-x" onclick="closeAuthPopups()"></i>
            </div>
            <h2>Login</h2>

            <div class="form-group">
                <label>Email</label>
                <input type="email" id="loginEmail">
            </div>

            <div class="form-group">
                <label>Password</label>
                <input type="password" id="loginPassword">
            </div>

            <div id="loginError" class="error-message"></div>

            <button class="auth-btn" onclick="handleLogin()">Login</button>
            <div class="auth-switch">
                Don't have an account? <span onclick="showSignup()">Sign Up</span>
            </div>
        </div>
    </div>

    <script type="module">
        // ============================================
        // FIREBASE IMPORTS
        // ============================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        import { 
            getFirestore, 
            doc,
            setDoc,
            getDoc,
            collection,
            getDocs,
            query,
            orderBy,
            enableIndexedDbPersistence
        } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        // ============================================
        // FIREBASE CONFIG
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAWsW8NaC-fs50D1hXganYW9gPCDUXRaMc",
            authDomain: "lyteit.firebaseapp.com",
            projectId: "lyteit",
            storageBucket: "lyteit.firebasestorage.app",
            messagingSenderId: "173900972036",
            appId: "1:173900972036:web:1bd22a25176bf5a716b551"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        enableIndexedDbPersistence(db).catch((err) => {
            if (err.code == 'failed-precondition') {
                console.log('Persistence failed: Multiple tabs open');
            } else if (err.code == 'unimplemented') {
                console.log('Persistence not supported');
            }
        });

        // ============================================
        // AVATAR LIST
        // ============================================
        const avatarList = [
            'https://iili.io/qf1x1K7.png',
            'https://iili.io/qf1IOa1.png',
            'https://iili.io/qf1TCox.jpg',
            'https://iili.io/qf1TZ0B.jpg',
            'https://iili.io/qf1uxzG.jpg',
            'https://iili.io/qf1AL8P.jpg'
        ];

        // ============================================
        // PRIVACY POLICY CHECK
        // ============================================
        function checkPrivacyAcceptance() {
            const accepted = localStorage.getItem('privacyAccepted');
            if (!accepted) {
                document.getElementById('privacyOverlay').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
            } else {
                document.getElementById('privacyOverlay').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                initializeApp();
            }
        }

        document.getElementById('acceptPrivacyBtn').addEventListener('click', () => {
            localStorage.setItem('privacyAccepted', 'true');
            document.getElementById('privacyOverlay').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            initializeApp();
        });

        // ============================================
        // AUTH STATE
        // ============================================
        let currentUser = null;

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // Get user profile from Firestore
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        ...userDoc.data()
                    };
                }
            } else {
                currentUser = null;
            }
            updateProfileDropdown();
            updateNewsletter();
        });

        // ============================================
        // PROFILE DROPDOWN
        // ============================================
        const profileIcon = document.getElementById('profileIcon');
        const profileDropdown = document.getElementById('profileDropdown');

        profileIcon.addEventListener('click', (e) => {
            e.stopPropagation();
            profileDropdown.classList.toggle('show');
        });

        document.addEventListener('click', () => {
            profileDropdown.classList.remove('show');
        });

        function updateProfileDropdown() {
            if (currentUser) {
                profileIcon.innerHTML = `<img src="${currentUser.avatar}" alt="avatar">`;
                profileDropdown.innerHTML = `
                    <div class="dropdown-user-info">
                        <div class="dropdown-avatar">
                            <img src="${currentUser.avatar}" alt="avatar">
                        </div>
                        <div class="dropdown-user-details">
                            <div class="dropdown-username">${currentUser.username}</div>
                            <div class="dropdown-email">${currentUser.email}</div>
                        </div>
                    </div>
                    <div class="dropdown-item" onclick="logout()">
                        <i class="ph ph-sign-out"></i>
                        <span>Logout</span>
                    </div>
                `;
            } else {
                profileIcon.innerHTML = '<i class="ph ph-user"></i>';
                profileDropdown.innerHTML = `
                    <div class="dropdown-item" onclick="showSignup()">
                        <i class="ph ph-user-plus"></i>
                        <span>Sign Up</span>
                    </div>
                    <div class="dropdown-item" onclick="showLogin()">
                        <i class="ph ph-sign-in"></i>
                        <span>Login</span>
                    </div>
                `;
            }
        }

        // ============================================
        // AUTH POPUPS
        // ============================================
        window.showSignup = function() {
            closeAuthPopups();
            document.getElementById('signupPopup').classList.add('show');
            renderAvatars();
        };

        window.showLogin = function() {
            closeAuthPopups();
            document.getElementById('loginPopup').classList.add('show');
        };

        window.closeAuthPopups = function() {
            document.getElementById('signupPopup').classList.remove('show');
            document.getElementById('loginPopup').classList.remove('show');
            document.getElementById('signupError').textContent = '';
            document.getElementById('loginError').textContent = '';
        };

        function renderAvatars() {
            const avatarGrid = document.getElementById('avatarGrid');
            avatarGrid.innerHTML = avatarList.map((url, index) => `
                <div class="avatar-option ${index === 0 ? 'selected' : ''}" onclick="selectAvatar(${index})">
                    <img src="${url}" alt="avatar ${index + 1}">
                </div>
            `).join('');
        }

        let selectedAvatar = 0;

        window.selectAvatar = function(index) {
            selectedAvatar = index;
            document.querySelectorAll('.avatar-option').forEach((opt, i) => {
                if (i === index) {
                    opt.classList.add('selected');
                } else {
                    opt.classList.remove('selected');
                }
            });
        };

        // Username and password character counters
        document.getElementById('signupUsername').addEventListener('input', (e) => {
            document.getElementById('usernameCount').textContent = e.target.value.length;
        });

        document.getElementById('signupPassword').addEventListener('input', (e) => {
            document.getElementById('passwordCount').textContent = e.target.value.length;
        });

        // ============================================
        // HANDLE SIGNUP
        // ============================================
        window.handleSignup = async function() {
            const username = document.getElementById('signupUsername').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const errorDiv = document.getElementById('signupError');

            // Validation
            if (!username || username.length > 9) {
                errorDiv.textContent = 'Username must be 1-9 characters';
                return;
            }
            if (!email || !email.includes('@')) {
                errorDiv.textContent = 'Please enter a valid email';
                return;
            }
            if (!password || password.length < 3 || password.length > 8) {
                errorDiv.textContent = 'Password must be 3-8 characters';
                return;
            }

            try {
                // Create user in Firebase Auth
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Save user profile to Firestore
                await setDoc(doc(db, 'users', user.uid), {
                    username: username,
                    email: email,
                    avatar: avatarList[selectedAvatar],
                    createdAt: new Date().toISOString(),
                    subscribed: true
                });

                closeAuthPopups();
            } catch (error) {
                errorDiv.textContent = error.message;
            }
        };

        // ============================================
        // HANDLE LOGIN
        // ============================================
        window.handleLogin = async function() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            if (!email || !password) {
                errorDiv.textContent = 'Please enter email and password';
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                closeAuthPopups();
            } catch (error) {
                errorDiv.textContent = 'Invalid email or password';
            }
        };

        // ============================================
        // LOGOUT
        // ============================================
        window.logout = async function() {
            await signOut(auth);
            profileDropdown.classList.remove('show');
        };

        // ============================================
        // NEWSLETTER
        // ============================================
        function updateNewsletter() {
            const emailInput = document.getElementById('newsletterEmail');
            const subscribeBtn = document.getElementById('subscribeBtn');
            const statusDiv = document.getElementById('newsletterStatus');

            if (currentUser) {
                emailInput.value = currentUser.email;
                emailInput.disabled = true;
                subscribeBtn.textContent = 'Subscribed ✓';
                subscribeBtn.disabled = true;
                statusDiv.className = 'newsletter-status success';
                statusDiv.textContent = `Subscribed as ${currentUser.email}`;
            } else {
                emailInput.value = '';
                emailInput.disabled = true;
                subscribeBtn.textContent = 'Login to Subscribe';
                subscribeBtn.disabled = true;
                statusDiv.className = '';
                statusDiv.textContent = '';
            }
        }

        // ============================================
        // APP STATE (Your existing app code continues here)
        // ============================================
        let currentPage = 'home';
        let allPosts = [];
        let allRssPosts = [];
        let searchTerm = '';
        
        let displayedPosts = [];
        let currentDisplayCount = 0;
        const POSTS_PER_BATCH = 3;
        let featuredPost = null;

        let isSearching = false;
        const videoPlayed = new Map();
        const expandedPosts = new Map();

        let exploreCategory = 'all';

        const postCache = new Map();
        const CACHE_DURATION = 5 * 60 * 1000;

        const RSS_FEEDS = [
            {
                name: 'CoinTelegraph',
                url: 'https://cointelegraph.com/rss',
                category: 'news',
                region: 'global',
                icon: 'ph-lightning',
                showOnHome: true
            },
            {
                name: 'Lyteit Blog',
                url: 'https://lyteit.blogspot.com/feeds/posts/default?alt=rss',
                category: 'news',
                region: 'nigeria',
                icon: 'ph-lightning',
                showOnHome: true
            },
            {
                name: 'MarketWatch',
                url: 'https://feeds.content.dowjones.io/public/rss/mw_topstories',
                category: 'news',
                region: 'global',
                icon: 'ph-chart-line',
                showOnHome: false
            },
            {
                name: 'Investing.com',
                url: 'https://www.investing.com/rss/news_25.rss',
                category: 'news',
                region: 'global',
                icon: 'ph-trend-up',
                showOnHome: false
            },
            {
                name: 'CNBC',
                url: 'https://www.cnbc.com/id/20409666/device/rss/rss.html',
                category: 'news',
                region: 'global',
                icon: 'ph-broadcast',
                showOnHome: false
            },
            {
                name: 'Entrepreneur Business Blog',
                url: 'https://www.entrepreneurbusinessblog.com/feed/',
                category: 'news',
                region: 'nigeria',
                icon: 'ph-buildings',
                showOnHome: false
            },
            {
                name: 'Nairametrics',
                url: 'https://nairametrics.com/feed/',
                category: 'news',
                region: 'nigeria',
                icon: 'ph-chart-pie',
                showOnHome: false
            },
            {
                name: 'Investing Nigeria',
                url: 'https://ng.investing.com/rss/market_overview_investing_ideas.rss',
                category: 'news',
                region: 'nigeria',
                icon: 'ph-map-pin',
                showOnHome: false
            }
        ];

        const exploreResources = [
            { name: "CoinMarketCap", description: "Live cryptocurrency prices, charts, and market data.", url: "https://coinmarketcap.com", category: "data", icon: "ph-chart-line" },
            { name: "CoinGecko", description: "Comprehensive crypto data platform with prices and analytics.", url: "https://coingecko.com", category: "data", icon: "ph-chart-line" },
            { name: "TradingView", description: "Advanced charts and technical analysis for financial markets.", url: "https://tradingview.com", category: "data", icon: "ph-chart-line" },
            { name: "Yahoo Finance", description: "Stock market data, news, and financial information.", url: "https://finance.yahoo.com", category: "data", icon: "ph-chart-line" },
            { name: "Investopedia", description: "Financial education - learn about investing and markets.", url: "https://investopedia.com", category: "education", icon: "ph-book-open" },
            { name: "Bitcoin.org", description: "Official Bitcoin resource. Beginner guides and whitepaper.", url: "https://bitcoin.org", category: "education", icon: "ph-book-open" },
            { name: "Ethereum.org", description: "Official Ethereum portal. Learn about ETH and Web3.", url: "https://ethereum.org", category: "education", icon: "ph-book-open" },
            { name: "CoinBureau", description: "In-depth crypto reviews and market analysis videos.", url: "https://youtube.com/@coinbureau", category: "video", icon: "ph-youtube-logo" },
            { name: "Bankless", description: "DeFi and crypto culture discussions with industry leaders.", url: "https://bankless.com", category: "video", icon: "ph-headphones" },
            { name: "Bloomberg Markets", description: "Financial news coverage and market analysis.", url: "https://bloomberg.com/markets", category: "video", icon: "ph-youtube-logo" }
        ];

        const categories = ['All', 'News', 'Data', 'Education', 'Video'];

        const trendingTopics = [
            { topic: "Bitcoin", icon: "ph-lightning" },
            { topic: "Ethereum", icon: "ph-code" },
            { topic: "Ripple XRP", icon: "ph-currency-circle-dollar" },
            { topic: "Nigeria Economy", icon: "ph-flag" },
            { topic: "Fed Decision", icon: "ph-bank" },
            { topic: "NGX All Share", icon: "ph-trend-up" }
        ];

        function getYouTubeVideoId(url) {
            if (!url) return null;
            const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/shorts\/)([^&\n?#]+)/);
            return match ? match[1] : null;
        }

        function makeLinksClickable(text) {
            if (!text) return '';
            const urlPattern = /(\b(https?:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*))/gi;
            return text.replace(urlPattern, (url) => {
                let href = url;
                if (!href.match(/^https?:\/\//i)) href = 'http://' + href;
                return `<a href="${href}" target="_blank" rel="noopener noreferrer">${url}</a>`;
            });
        }

        function formatContent(text) {
            if (!text) return '';
            const withLinks = makeLinksClickable(text);
            return withLinks.split(/\n\s*\n/).map(para => {
                if (!para.trim()) return '';
                const lines = para.split('\n').map(l => l.trim()).filter(l => l);
                if (lines.length === 0) return '';
                if (lines.length === 1) return `<p>${lines[0]}</p>`;
                return `<p>${lines.join('<br>')}</p>`;
            }).join('');
        }

        function truncateForPreview(text, limit = 150) {
            if (!text) return '';
            const plain = text.replace(/\n/g, ' ').replace(/\s+/g, ' ').trim();
            if (plain.length <= limit) return formatContent(text);
            return `<p>${plain.substring(0, limit).split(' ').slice(0, -1).join(' ')}...</p>`;
        }

        function getRelativeTime(timestamp) {
            if (!timestamp) return 'Just now';
            
            try {
                let postDate;
                
                if (timestamp && typeof timestamp === 'object' && timestamp.seconds) {
                    postDate = new Date(timestamp.seconds * 1000);
                } else if (timestamp.toDate) {
                    postDate = timestamp.toDate();
                } else if (typeof timestamp === 'string') {
                    postDate = new Date(timestamp);
                } else if (typeof timestamp === 'number') {
                    postDate = new Date(timestamp);
                } else if (timestamp && timestamp._seconds) {
                    postDate = new Date(timestamp._seconds * 1000);
                } else {
                    return 'Just now';
                }

                if (isNaN(postDate.getTime())) return 'Just now';

                const now = new Date();
                const diffMs = now - postDate;
                const diffSecs = Math.floor(diffMs / 1000);
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                if (diffSecs < 5) return 'Just now';
                if (diffSecs < 60) return `${diffSecs} seconds ago`;
                if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
                if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
                if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
                
                return postDate.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });
            } catch (error) {
                return 'Just now';
            }
        }

        function updateTopNavigation(page) {
            document.querySelectorAll('.desktop-menu a').forEach(link => {
                link.classList.remove('active');
            });
            
            const activeLink = document.getElementById(`top-nav-${page}`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }

        async function fetchAllRssFeeds(onlyHomeFeeds = false) {
            console.log('Fetching RSS feeds...');
            document.getElementById('cacheIndicator').innerHTML = '<i class="ph ph-cloud-arrow-up"></i> Fetching RSS feeds';
            
            try {
                const allArticles = [];
                
                let feedsToFetch = RSS_FEEDS;
                if (onlyHomeFeeds) {
                    feedsToFetch = RSS_FEEDS.filter(feed => feed.showOnHome === true);
                }
                
                const RSS2JSON_API = 'https://api.rss2json.com/v1/api.json?rss_url=';
                
                const feedPromises = feedsToFetch.map(async (feed) => {
                    try {
                        const response = await fetch(RSS2JSON_API + encodeURIComponent(feed.url));
                        const data = await response.json();
                        
                        if (data.status === 'ok' && data.items) {
                            const articles = data.items.slice(0, 10).map(item => {
                                let image = item.thumbnail || '';
                                if (!image && item.description) {
                                    const imgMatch = item.description.match(/<img[^>]+src="([^">]+)"/);
                                    if (imgMatch) image = imgMatch[1];
                                }
                                
                                const content = item.description ? item.description.replace(/<[^>]*>/g, '') : '';
                                
                                return {
                                    id: `rss-${feed.name}-${item.guid || item.link || Date.now()}`,
                                    title: item.title || 'No title',
                                    content: content.substring(0, 300),
                                    image: image || `https://images.unsplash.com/photo-1621761126064-fdd80772bc22`,
                                    source: feed.name,
                                    sourceUrl: item.link,
                                    category: 'news',
                                    region: feed.region,
                                    type: 'article',
                                    createdAt: item.pubDate ? new Date(item.pubDate) : new Date(),
                                    rss: true
                                };
                            });
                            
                            return articles;
                        }
                        return [];
                    } catch (error) {
                        console.error(`Error fetching ${feed.name}:`, error);
                        return [];
                    }
                });
                
                const results = await Promise.all(feedPromises);
                
                allArticles.push(...results.flat());
                allArticles.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                document.getElementById('cacheIndicator').innerHTML = 
                    `<i class="ph ph-database"></i> RSS: ${allArticles.length} articles`;
                
                return allArticles;
            } catch (error) {
                console.error('Error fetching RSS feeds:', error);
                return [];
            }
        }

        async function getFirebasePosts() {
            const cacheKey = 'firebase-posts';
            const cached = postCache.get(cacheKey);
            
            if (cached && (Date.now() - cached.timestamp) < CACHE_DURATION) {
                console.log('Serving Firebase posts from cache');
                return cached.data;
            }
            
            console.log('Fetching fresh posts from Firestore');
            
            try {
                const q = query(collection(db, 'posts'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                
                const posts = [];
                snapshot.forEach(doc => {
                    posts.push({ 
                        id: doc.id, 
                        ...doc.data()
                    });
                });
                
                postCache.set(cacheKey, {
                    data: posts,
                    timestamp: Date.now()
                });
                
                return posts;
            } catch (error) {
                console.error('Error fetching Firebase posts:', error);
                return [];
            }
        }

        async function getAllPosts(forHomePage = true) {
            const [firebasePosts, rssPosts] = await Promise.all([
                getFirebasePosts(),
                fetchAllRssFeeds(forHomePage)
            ]);
            
            allRssPosts = rssPosts;
            
            const merged = [...firebasePosts, ...rssPosts];
            merged.sort((a, b) => {
                const dateA = a.createdAt?.seconds ? new Date(a.createdAt.seconds * 1000) : new Date(a.createdAt);
                const dateB = b.createdAt?.seconds ? new Date(b.createdAt.seconds * 1000) : new Date(b.createdAt);
                return dateB - dateA;
            });
            
            return merged;
        }

        window.navigateTo = function(page) {
            currentPage = page;
            
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById(`nav-${page}`)?.classList.add('active');
            
            updateTopNavigation(page);
            
            const homeSearch = document.getElementById('homeSearch');
            const homeTrending = document.getElementById('homeTrending');
            
            if (page === 'home') {
                homeSearch.style.display = 'block';
                homeTrending.style.display = 'flex';
                loadHomePage();
            } else {
                homeSearch.style.display = 'none';
                homeTrending.style.display = 'none';
                if (page === 'explore') loadExplorePage();
                else if (page === 'markets') loadMarketsPage();
                else if (page === 'play') { window.open('https://example.com', '_blank'); navigateTo('home'); }
                else if (page === 'menu') { showComingSoon('Menu'); navigateTo('home'); }
            }
        };

        function getHomePageHTML() {
            return `
                <div class="page-indicator">
                    <i class="ph ph-house"></i> Home
                    <button class="rss-refresh-btn" onclick="refreshRSS()"><i class="ph ph-arrow-clockwise"></i> Refresh News</button>
                </div>
                <div id="searchResultsHeader" class="search-results-header" style="display: none;"></div>
                <div id="featuredSection"></div>
                <div class="news-list" id="newsList"></div>
                <div class="load-more-container" id="loadMoreContainer">
                    <button class="load-more-btn" id="loadMoreBtn" onclick="loadMorePosts()"><i class="ph ph-arrow-down"></i> View More</button>
                </div>
            `;
        }

        window.refreshRSS = async function() {
            const btn = document.querySelector('.rss-refresh-btn');
            btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i> Refreshing...';
            btn.disabled = true;
            
            postCache.delete('firebase-posts');
            await loadHomePage();
            
            btn.innerHTML = '<i class="ph ph-arrow-clockwise"></i> Refresh News';
            btn.disabled = false;
        };

        async function loadHomePage() {
            document.getElementById('mainContent').innerHTML = getHomePageHTML();
            try {
                allPosts = await getAllPosts(true);
                
                if (allPosts.length === 0) {
                    document.getElementById('featuredSection').innerHTML = '<div class="loading">No news yet</div>';
                    document.getElementById('loadMoreContainer').style.display = 'none';
                    return;
                }
                
                const featured = allPosts.filter(p => p.featured === true);
                featuredPost = featured.length ? featured[Math.floor(Math.random() * featured.length)] : allPosts[0];
                displayedPosts = allPosts.filter(p => p.id !== featuredPost.id);
                currentDisplayCount = 0;
                renderFeaturedPost(featuredPost);
                await loadMorePosts(true);
                setupSearch();
            } catch (error) {
                console.error('Error loading home page:', error);
                document.getElementById('featuredSection').innerHTML = '<div class="loading" style="color:#ff5252;">Error loading news</div>';
            }
        }

        window.loadMorePosts = async function(reset = false) {
            if (isSearching) return;
            const btn = document.getElementById('loadMoreBtn');
            const list = document.getElementById('newsList');
            if (!list) return;
            if (btn) { btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i> Loading...'; btn.disabled = true; }
            try {
                const start = reset ? 0 : currentDisplayCount;
                const end = start + POSTS_PER_BATCH;
                const posts = displayedPosts.slice(start, end);
                if (posts.length === 0) { 
                    if (reset && list.innerHTML === '') {
                        list.innerHTML = '<div class="loading">No more posts</div>';
                    }
                    document.getElementById('loadMoreContainer').style.display = 'none'; 
                    return; 
                }
                currentDisplayCount = end;
                let html = reset ? '' : list.innerHTML;
                for (const p of posts) {
                    html += p.type === 'video' ? renderVideoPost(p) : renderArticlePost(p);
                }
                list.innerHTML = html;
                
                if (btn) {
                    if (currentDisplayCount >= displayedPosts.length) {
                        btn.innerHTML = '<i class="ph ph-check-circle"></i> All Posts Loaded';
                        btn.disabled = true;
                    } else {
                        btn.innerHTML = '<i class="ph ph-arrow-down"></i> View More';
                        btn.disabled = false;
                    }
                }
            } catch (error) {
                console.error('Error loading more posts:', error);
                if (btn) { btn.innerHTML = '<i class="ph ph-arrow-down"></i> Try Again'; btn.disabled = false; }
            }
        };

        function renderArticlePost(post) {
            const expanded = expandedPosts.get(post.id) || false;
            const isRSS = post.rss === true;
            
            return `
                <div class="news-item" id="post-${post.id}" onclick="window.open('${post.sourceUrl || '#'}','_blank')">
                    <img src="${post.image}" class="news-item-img" onerror="this.src='https://images.unsplash.com/photo-1621761126064-fdd80772bc22'">
                    <div class="news-item-content">
                        <div class="news-item-title">${post.title}</div>
                        ${post.source ? `
                            <div class="rss-source-badge">
                                <i class="ph ph-newspaper"></i> ${post.source}
                                ${post.region === 'nigeria' ? '<i class="ph ph-flag" style="margin-left:4px;"></i>' : ''}
                            </div>
                        ` : ''}
                        <div class="post-content-container" data-full-content="${(post.content || '').replace(/"/g, '&quot;')}">
                            ${expanded ? formatContent(post.content) : truncateForPreview(post.content, 100)}
                        </div>
                        ${(post.content || '').length > 100 ? `
                            <button class="read-more-btn" style="font-size:0.7rem;" onclick="event.stopPropagation(); toggleReadMore('${post.id}', false, event)">${expanded ? 'less' : 'more'}</button>
                        ` : ''}
                        
                        ${!isRSS ? `
                            <div class="meta-info">
                                <span><i class="ph ph-clock"></i> ${getRelativeTime(post.createdAt || post.timestamp)}</span>
                                ${post.featured ? '<span class="article-featured">⭐ Featured</span>' : ''}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderVideoPost(post) {
            const videoId = getYouTubeVideoId(post.youtubeUrl) || 'dQw4w9WgXcQ';
            const expanded = expandedPosts.get(post.id) || false;
            const played = videoPlayed.get(post.id) || false;
            const isRSS = post.rss === true;
            
            return `
                <div class="video-card" id="post-${post.id}">
                    <div class="video-header"><i class="ph-fill ph-youtube-logo"></i><div class="video-title">${post.title}</div></div>
                    <div class="video-container" id="video-${post.id}" onclick="playVideo('${post.id}', event)">
                        <iframe src="https://www.youtube.com/embed/${videoId}?enablejsapi=1" allowfullscreen></iframe>
                        <div class="video-play-overlay ${played ? 'hidden' : ''}"><div class="video-play-button"><i class="ph-fill ph-play"></i></div></div>
                    </div>
                    ${post.description ? `
                        <div class="video-description">
                            <div class="post-content-container" data-full-content="${(post.description || '').replace(/"/g, '&quot;')}">
                                ${expanded ? formatContent(post.description) : truncateForPreview(post.description, 150)}
                            </div>
                            ${post.description.length > 150 ? `
                                <button class="read-more-btn" style="margin-top:10px;" onclick="toggleReadMore('${post.id}', false, event)">
                                    ${expanded ? 'Show less' : 'Read more'}
                                </button>
                            ` : ''}
                        </div>
                    ` : ''}
                    <div style="padding:15px;">
                        ${!isRSS ? `
                            <div class="meta-info">
                                <span><i class="ph ph-clock"></i> ${getRelativeTime(post.createdAt || post.timestamp)}</span>
                                ${post.featured ? '<span class="article-featured">⭐ Featured</span>' : ''}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderFeaturedPost(featured) {
            const el = document.getElementById('featuredSection');
            if (!el) return;
            
            const isRSS = featured.rss === true;
            
            if (featured.type === 'video') {
                const videoId = getYouTubeVideoId(featured.youtubeUrl) || 'dQw4w9WgXcQ';
                const expanded = expandedPosts.get(featured.id) || false;
                const played = videoPlayed.get(featured.id) || false;
                el.innerHTML = `
                    <div class="video-card" id="post-${featured.id}">
                        <div class="video-header"><i class="ph-fill ph-youtube-logo"></i><div class="video-title">${featured.title}</div></div>
                        <div class="video-container" id="video-${featured.id}" onclick="playVideo('${featured.id}', event)">
                            <iframe src="https://www.youtube.com/embed/${videoId}?enablejsapi=1" allowfullscreen></iframe>
                            <div class="video-play-overlay ${played ? 'hidden' : ''}"><div class="video-play-button"><i class="ph-fill ph-play"></i></div></div>
                        </div>
                        ${featured.description ? `
                            <div class="video-description">
                                <div class="post-content-container" data-full-content="${(featured.description || '').replace(/"/g, '&quot;')}">
                                    ${expanded ? formatContent(featured.description) : truncateForPreview(featured.description, 150)}
                                </div>
                                ${featured.description.length > 150 ? `
                                    <button class="read-more-btn" style="margin-top:10px;" onclick="toggleReadMore('${featured.id}', true, event)">
                                        ${expanded ? 'Show less' : 'Read more'}
                                    </button>
                                ` : ''}
                            </div>
                        ` : ''}
                        <div style="padding:15px;">
                            ${!isRSS ? `
                                <div class="meta-info">
                                    <span><i class="ph ph-clock"></i> ${getRelativeTime(featured.createdAt || featured.timestamp)}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            } else {
                const expanded = expandedPosts.get(featured.id) || false;
                el.innerHTML = `
                    <div class="featured-card" id="post-${featured.id}" onclick="window.open('${featured.sourceUrl || '#'}','_blank')">
                        <img src="${featured.image}" class="featured-img" onerror="this.src='https://images.unsplash.com/photo-1639762681485-074b7f938ba0'">
                        <h1 class="featured-title">${featured.title}</h1>
                        ${featured.source ? `
                            <div class="rss-source-badge" style="margin:5px 0;">
                                <i class="ph ph-newspaper"></i> ${featured.source}
                            </div>
                        ` : ''}
                        <div class="featured-content" onclick="event.stopPropagation()">
                            <div class="post-content-container" data-full-content="${(featured.content || '').replace(/"/g, '&quot;')}">
                                ${expanded ? formatContent(featured.content) : truncateForPreview(featured.content, 150)}
                            </div>
                            ${(featured.content || '').length > 150 ? `
                                <button class="read-more-btn" onclick="toggleReadMore('${featured.id}', true, event)">
                                    ${expanded ? 'Show less' : 'Read more'}
                                </button>
                            ` : ''}
                        </div>
                        ${!isRSS ? `
                            <div class="meta-info" style="margin-top:10px;">
                                <span><i class="ph ph-clock"></i> ${getRelativeTime(featured.createdAt || featured.timestamp)}</span>
                            </div>
                        ` : ''}
                        ${featured.featured ? '<div style="margin-top:10px;"><span class="article-featured">⭐ Featured</span></div>' : ''}
                    </div>
                `;
            }
        }

        window.playVideo = function(videoId, event) {
            if (event) event.stopPropagation();
            const container = document.getElementById(`video-${videoId}`);
            if (!container) return;
            const overlay = container.querySelector('.video-play-overlay');
            const iframe = container.querySelector('iframe');
            if (overlay && iframe) {
                overlay.classList.add('hidden');
                iframe.src = iframe.src + (iframe.src.includes('?') ? '&' : '?') + 'autoplay=1';
                videoPlayed.set(videoId, true);
            }
        };

        window.toggleReadMore = function(postId, featured, event) {
            if (event) event.stopPropagation();
            const expanded = expandedPosts.get(postId) || false;
            expandedPosts.set(postId, !expanded);
            const post = document.getElementById(`post-${postId}`);
            const container = post?.querySelector('.post-content-container');
            const btn = post?.querySelector('.read-more-btn');
            if (!container || !btn) return;
            const full = container.getAttribute('data-full-content');
            if (expanded) {
                container.innerHTML = truncateForPreview(full, featured ? 150 : 100);
                btn.innerHTML = 'Read more <i class="ph ph-arrow-down"></i>';
            } else {
                container.innerHTML = formatContent(full);
                btn.innerHTML = 'Show less <i class="ph ph-arrow-up"></i>';
            }
        };

        function setupSearch() {
            document.getElementById('searchInput')?.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase().trim();
                performSearch(term);
            });
        }

        window.searchTrendingTopic = function(topic) {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = topic;
                performSearch(topic);
            }
        };

        async function performSearch(term) {
            if (!term) {
                isSearching = false;
                document.getElementById('searchResultsHeader').style.display = 'none';
                document.getElementById('featuredSection').style.display = 'block';
                document.getElementById('loadMoreContainer').style.display = 'flex';
                await loadHomePage();
                return;
            }
            isSearching = true;
            const lower = term.toLowerCase();
            const filtered = allPosts.filter(p => {
                if (p.type === 'video') {
                    return p.title.toLowerCase().includes(lower) || (p.description || '').toLowerCase().includes(lower);
                }
                return p.title.toLowerCase().includes(lower) || (p.content || '').toLowerCase().includes(lower) || 
                       (p.source && p.source.toLowerCase().includes(lower));
            });
            document.getElementById('featuredSection').style.display = 'none';
            document.getElementById('loadMoreContainer').style.display = 'none';
            const header = document.getElementById('searchResultsHeader');
            header.style.display = 'block';
            header.innerHTML = `Found ${filtered.length} result${filtered.length > 1 ? 's' : ''} for "${term}" <span class="clear-search" onclick="clearSearch()">Clear search</span>`;
            const list = document.getElementById('newsList');
            if (!filtered.length) {
                list.innerHTML = '<div class="loading">No results found</div>';
                return;
            }
            list.innerHTML = filtered.map(p => p.type === 'video' ? renderVideoPost(p) : renderArticlePost(p)).join('');
        }

        window.clearSearch = function() {
            searchTerm = '';
            document.getElementById('searchInput').value = '';
            performSearch('');
        };

        function renderTrending() {
            const el = document.getElementById('homeTrending');
            if (el) {
                el.innerHTML = trendingTopics.map(t => `
                    <div class="trending-item" onclick="searchTrendingTopic('${t.topic}')">
                        <i class="ph ${t.icon}"></i><span>${t.topic}</span>
                    </div>
                `).join('');
            }
        }

        function loadExplorePage() {
            document.getElementById('mainContent').innerHTML = `
                <div class="page-indicator"><i class="ph ph-compass"></i> Explore</div>
                <div class="explore-header">
                    <div class="explore-search-wrapper">
                        <i class="ph ph-magnifying-glass explore-search-icon"></i>
                        <input type="text" class="explore-search-input" id="exploreSearch" placeholder="Search resources by name, description, or category...">
                    </div>
                    <div class="explore-categories" id="exploreCategories">
                        ${categories.map(cat => `
                            <span class="explore-category-tag ${cat.toLowerCase() === exploreCategory ? 'active' : ''}" onclick="filterExploreByCategory('${cat.toLowerCase()}')">${cat}</span>
                        `).join('')}
                    </div>
                </div>
                <div class="explore-grid" id="exploreGrid">
                    ${renderExploreContent('all')}
                </div>
            `;
            
            document.getElementById('exploreSearch')?.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                filterExploreContent(term, exploreCategory);
            });
        }

        window.filterExploreByCategory = function(category) {
            exploreCategory = category;
            document.querySelectorAll('.explore-category-tag').forEach(tag => {
                if (tag.textContent.toLowerCase() === category || (category === 'all' && tag.textContent.toLowerCase() === 'all')) {
                    tag.classList.add('active');
                } else {
                    tag.classList.remove('active');
                }
            });
            
            const searchTerm = document.getElementById('exploreSearch')?.value.toLowerCase() || '';
            filterExploreContent(searchTerm, category);
        };

        function renderExploreContent(category, searchTerm = '') {
            if (category === 'all') {
                const rssArticles = allRssPosts.slice(0, 10).map(post => ({
                    ...post,
                    exploreType: 'rss'
                }));
                
                const allItems = [...rssArticles, ...exploreResources];
                
                const filtered = allItems.filter(item => {
                    if (item.exploreType === 'rss') {
                        return searchTerm === '' || 
                               item.title.toLowerCase().includes(searchTerm) ||
                               item.source.toLowerCase().includes(searchTerm) ||
                               item.content.toLowerCase().includes(searchTerm);
                    } else {
                        return searchTerm === '' || 
                               item.name.toLowerCase().includes(searchTerm) ||
                               item.description.toLowerCase().includes(searchTerm) ||
                               item.category.toLowerCase().includes(searchTerm);
                    }
                });
                
                if (filtered.length === 0) {
                    return '<div class="loading">No results found</div>';
                }
                
                return filtered.map(item => {
                    if (item.exploreType === 'rss') {
                        return `
                            <div class="explore-card" onclick="window.open('${item.sourceUrl}','_blank')">
                                <div class="explore-card-header">
                                    <div class="explore-icon"><i class="ph ph-newspaper"></i></div>
                                    <div class="explore-name">${item.title.substring(0, 40)}${item.title.length > 40 ? '...' : ''}</div>
                                </div>
                                <span class="explore-category">📰 News • ${item.source} ${item.region === 'nigeria' ? '🇳🇬' : ''}</span>
                                <div class="explore-description">${item.content.substring(0, 100)}${item.content.length > 100 ? '...' : ''}</div>
                                <div class="explore-url">
                                    <i class="ph ph-link"></i>
                                    ${item.sourceUrl ? item.sourceUrl.replace('https://', '').substring(0, 30) + '...' : 'Read more'}
                                </div>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="explore-card" onclick="window.open('${item.url}','_blank')">
                                <div class="explore-card-header">
                                    <div class="explore-icon"><i class="ph ${item.icon}"></i></div>
                                    <div class="explore-name">${item.name}</div>
                                </div>
                                <span class="explore-category">${item.category}</span>
                                <div class="explore-description">${item.description}</div>
                                <div class="explore-url">
                                    <i class="ph ph-link"></i>
                                    ${item.url.replace('https://', '').replace('http://', '')}
                                </div>
                            </div>
                        `;
                    }
                }).join('');
            } 
            else if (category === 'news') {
                const rssArticles = allRssPosts.filter(post => {
                    return searchTerm === '' || 
                           post.title.toLowerCase().includes(searchTerm) ||
                           post.source.toLowerCase().includes(searchTerm) ||
                           post.content.toLowerCase().includes(searchTerm);
                });
                
                if (rssArticles.length === 0) {
                    return '<div class="loading">No news articles found</div>';
                }
                
                return rssArticles.slice(0, 20).map(post => `
                    <div class="explore-card" onclick="window.open('${post.sourceUrl}','_blank')">
                        <div class="explore-card-header">
                            <div class="explore-icon"><i class="ph ph-newspaper"></i></div>
                            <div class="explore-name">${post.title.substring(0, 40)}${post.title.length > 40 ? '...' : ''}</div>
                        </div>
                        <span class="explore-category">📰 ${post.source} ${post.region === 'nigeria' ? '🇳🇬' : ''}</span>
                        <div class="explore-description">${post.content.substring(0, 100)}${post.content.length > 100 ? '...' : ''}</div>
                        <div class="explore-url">
                            <i class="ph ph-link"></i>
                            ${post.sourceUrl ? post.sourceUrl.replace('https://', '').substring(0, 30) + '...' : 'Read more'}
                        </div>
                    </div>
                `).join('');
            }
            else {
                const filtered = exploreResources.filter(r => 
                    r.category === category && 
                    (searchTerm === '' || 
                     r.name.toLowerCase().includes(searchTerm) || 
                     r.description.toLowerCase().includes(searchTerm))
                );
                
                if (filtered.length === 0) {
                    return '<div class="loading">No resources found</div>';
                }
                
                return filtered.map(r => `
                    <div class="explore-card" onclick="window.open('${r.url}','_blank')">
                        <div class="explore-card-header">
                            <div class="explore-icon"><i class="ph ${r.icon}"></i></div>
                            <div class="explore-name">${r.name}</div>
                        </div>
                        <span class="explore-category">${r.category}</span>
                        <div class="explore-description">${r.description}</div>
                        <div class="explore-url">
                            <i class="ph ph-link"></i>
                            ${r.url.replace('https://', '').replace('http://', '')}
                        </div>
                    </div>
                `).join('');
            }
        }

        function filterExploreContent(searchTerm = '', category = 'all') {
            document.getElementById('exploreGrid').innerHTML = renderExploreContent(category, searchTerm.toLowerCase());
        }

        function loadMarketsPage() {
            document.getElementById('mainContent').innerHTML = `
                <div class="page-indicator"><i class="ph ph-chart-line-up"></i> Markets</div>
                <div class="markets-header">
                    <div class="markets-refresh">
                        <i class="ph ph-clock"></i>
                        <span id="marketUpdateTime">Loading...</span>
                    </div>
                    <div class="markets-refresh">
                        <i class="ph ph-database"></i>
                        <span id="cacheStatus"></span>
                    </div>
                </div>
                <div class="markets-grid" id="marketsGrid">
                    <div class="loading">Loading prices...</div>
                </div>
            `;
            
            loadMarketsWithCache();
        }

        async function loadMarketsWithCache() {
            const cacheKey = 'marketData';
            const cacheTimeKey = 'marketDataTime';
            const CACHE_DURATION = 15 * 60 * 1000;
            
            const cachedData = localStorage.getItem(cacheKey);
            const cachedTime = localStorage.getItem(cacheTimeKey);
            const cacheStatus = document.getElementById('cacheStatus');
            const updateTime = document.getElementById('marketUpdateTime');
            
            if (cachedData && cachedTime) {
                const age = Date.now() - parseInt(cachedTime);
                if (age < CACHE_DURATION) {
                    const coins = JSON.parse(cachedData);
                    renderMarkets(coins);
                    if (updateTime) {
                        const date = new Date(parseInt(cachedTime));
                        updateTime.textContent = `Cached: ${date.toLocaleTimeString()}`;
                    }
                    if (cacheStatus) {
                        const minsAgo = Math.floor(age / 60000);
                        cacheStatus.textContent = `📦 Cache: ${minsAgo}m old`;
                    }
                    
                    setTimeout(() => fetchMarkets(true), 100);
                    return;
                } else {
                    if (cacheStatus) {
                        cacheStatus.textContent = `📦 Cache expired, fetching fresh...`;
                    }
                }
            }
            
            await fetchMarkets(false);
        }

        async function fetchMarkets(background = false) {
            try {
                if (!background) {
                    document.getElementById('marketsGrid').innerHTML = '<div class="loading">Loading fresh prices...</div>';
                }
                
                const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=50&sparkline=true');
                const coins = await response.json();
                
                localStorage.setItem('marketData', JSON.stringify(coins));
                localStorage.setItem('marketDataTime', Date.now().toString());
                
                renderMarkets(coins);
                
                const updateTime = document.getElementById('marketUpdateTime');
                if (updateTime) {
                    updateTime.textContent = `Updated: ${new Date().toLocaleTimeString()}`;
                }
                
                const cacheStatus = document.getElementById('cacheStatus');
                if (cacheStatus) {
                    cacheStatus.textContent = `📦 Cache: fresh`;
                }
                
                setTimeout(fetchMarkets, 900000);
                
            } catch (error) {
                console.error('Error fetching markets:', error);
                
                const cachedData = localStorage.getItem('marketData');
                if (cachedData && !background) {
                    const coins = JSON.parse(cachedData);
                    renderMarkets(coins);
                    document.getElementById('marketUpdateTime').textContent = 'Using cached data (offline)';
                } else {
                    document.getElementById('marketsGrid').innerHTML = '<div class="loading" style="color:#ff5252;">Error loading prices. Please refresh.</div>';
                }
            }
        }

        function renderMarkets(coins) {
            document.getElementById('marketsGrid').innerHTML = coins.map(c => `
                <div class="coin-card">
                    <div class="coin-header">
                        <span class="coin-rank">#${c.market_cap_rank}</span>
                        <span class="coin-name">${c.name}</span>
                        <span class="coin-symbol">${c.symbol.toUpperCase()}</span>
                    </div>
                    <div class="coin-price">$${c.current_price.toLocaleString()}</div>
                    <div class="coin-change ${c.price_change_percentage_24h >= 0 ? 'positive' : 'negative'}">
                        ${c.price_change_percentage_24h >= 0 ? '+' : ''}${c.price_change_percentage_24h?.toFixed(2)}%
                    </div>
                    <div class="coin-chart">
                        <canvas id="chart-${c.id}" width="100%" height="60"></canvas>
                    </div>
                </div>
            `).join('');
            
            if (window.Chart) {
                setTimeout(() => {
                    coins.forEach(c => {
                        const canvas = document.getElementById(`chart-${c.id}`);
                        if (canvas && c.sparkline_in_7d?.price) {
                            new Chart(canvas, {
                                type: 'line',
                                data: { 
                                    labels: c.sparkline_in_7d.price.map((_,i)=>i), 
                                    datasets: [{ 
                                        data: c.sparkline_in_7d.price, 
                                        borderColor: c.price_change_percentage_24h >= 0 ? '#00c853' : '#ff5252', 
                                        borderWidth: 2, 
                                        pointRadius: 0,
                                        tension: 0.4,
                                        fill: false
                                    }] 
                                },
                                options: { 
                                    responsive: true, 
                                    maintainAspectRatio: false, 
                                    plugins: { 
                                        legend: { display: false }, 
                                        tooltip: { enabled: false } 
                                    }, 
                                    scales: { 
                                        x: { display: false }, 
                                        y: { display: false } 
                                    },
                                    elements: {
                                        line: {
                                            borderWidth: 2
                                        }
                                    }
                                }
                            });
                        }
                    });
                }, 100);
            }
        }

        function showComingSoon(feature) {
            alert(`${feature} feature coming soon!`);
        }

        function setupEventListeners() {
            document.getElementById('backToTop')?.addEventListener('click', () => {
                document.getElementById('scrollableContent').scrollTo({ top: 0, behavior: 'smooth' });
            });
            document.getElementById('logo')?.addEventListener('click', () => {
                document.getElementById('scrollableContent').scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            document.getElementById('appStoreBtn')?.addEventListener('click', () => showComingSoon('iOS App'));
            document.getElementById('playStoreBtn')?.addEventListener('click', () => showComingSoon('Android App'));
            document.getElementById('aboutLink')?.addEventListener('click', () => showComingSoon('About'));
            document.getElementById('privacyLink')?.addEventListener('click', () => showComingSoon('Privacy'));
            document.getElementById('termsLink')?.addEventListener('click', () => showComingSoon('Terms'));
            document.getElementById('contactLink')?.addEventListener('click', () => showComingSoon('Contact'));
        }

        function initializeApp() {
            renderTrending();
            setupEventListeners();
            updateTopNavigation('home');
            navigateTo('home');
        }

        // Start the app
        checkPrivacyAcceptance();
    </script>
</body>
</html>
